<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìˆ™ì œ ì œì¶œ - Ltryi</title>
  <link rel="stylesheet" href="styles-frame.css">
  <link rel="stylesheet" href="styles-room.css">
</head>
<body>
  <div class="main-page">
    <div class="date" id="main-page-header">ìˆ™ì œ ì œì¶œ</div>

    <div class="treeframe">
      <div class="corkframe">

        <!-- ìˆ™ì œ ë‹¤ìš´ë¡œë“œ ë§í¬ -->
        <div style="margin-bottom: 10px;">
          <label>ğŸ“„ ì˜¤ëŠ˜ì˜ ìˆ™ì œ íŒŒì¼:</label><br>
          <a id="hwDownload" href="#" download style="color:#4b2600; font-weight: bold;">ë‹¤ìš´ë¡œë“œ í•˜ê¸°</a>
        </div>

        <!-- ìˆ™ì œ ì—…ë¡œë“œ -->
        <label>ğŸ“¸ ìˆ™ì œ ì‚¬ì§„ ì—…ë¡œë“œ:</label>
        <input type="file" id="hwImage" accept="image/*" style="margin-bottom: 10px;"><br>

        <!-- ìˆ™ì œ ì™„ë£Œ ì²´í¬ -->
        <label>
          <input type="checkbox" id="hwDoneCheck">
          ì˜¤ëŠ˜ ìˆ™ì œë¥¼ ì™„ë£Œí–ˆì–´ìš”!
        </label><br><br>

        <!-- ì½”ë©˜íŠ¸ -->
        <label>ğŸ“ ì½”ë©˜íŠ¸:</label>
        <textarea class="comment-box" id="hwComment" placeholder="ì½”ë©˜íŠ¸ (ì„ íƒ)"></textarea>

        <!-- ì œì¶œ ë²„íŠ¼ -->
        <button class="room-btn" onclick="submitHomework()">ì œì¶œí•˜ê¸°</button>
      </div>

      <div class="postitcorner"></div>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
  const userId = urlParams.get('id');

  async function submitHomework() {
    const fileInput = document.getElementById('hwImage');
    const isDone = document.getElementById('hwDoneCheck').checked;
    const comment = document.getElementById('hwComment').value;
    const file = fileInput.files[0];

    if (!file) {
      alert("ìˆ™ì œ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”!");
      return;
    }

    // âœ… ì—…ë¡œë“œìš© ì •ë³´ êµ¬ì„± (ì„ì‹œë¡œ ê³ ì •ê°’ ì‚¬ìš©)
    const formData = new FormData();
    formData.append("UserId", userId);
    formData.append("QLevel", "7");        // í•™ë…„ or ìˆ˜ì¤€
    formData.append("QYear", "2025");       // ì—°ë„
    formData.append("QMonth", "5");        // ì›”
    formData.append("QNo", "1");           // ê³¼ì œë²ˆí˜¸
    formData.append("WhichHW", isDone ? "done" : "draft"); // ì œì¶œ ì—¬ë¶€
    formData.append("HWImage", file);       // íŒŒì¼ ë³¸ì²´

    try {
      const res = await fetch("https://port-0-ltryi-database-1ru12mlw3glz2u.sel5.cloudtype.app/api/saveHWImages", {
        method: "POST",
        body: formData
      });

      const result = await res.json();

      if (res.ok) {
        alert("ì œì¶œ ì„±ê³µ! ğŸ‰\nURL: " + result.url);
      } else {
        console.error(result);
        alert("ì œì¶œ ì‹¤íŒ¨: " + result.message);
      }
    } catch (err) {
      console.error("ìš”ì²­ ì¤‘ ì—ëŸ¬:", err);
      alert("ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
  }
  </script>
</body>
</html>
